# ğŸ”§ ReadTimeout ë¬¸ì œ í•´ê²° ê°€ì´ë“œ

## ğŸ¯ **ë¬¸ì œ í•´ê²° ì™„ë£Œ**

**ReadTimeout** ë¬¸ì œë¥¼ ë‹¤ìŒê³¼ ê°™ì´ í•´ê²°í–ˆìŠµë‹ˆë‹¤:

### âœ… **1. ìë™ ì¬ì‹œë„ + ì§€ìˆ˜ ë°±ì˜¤í”„**
```python
max_retries = 3
base_timeout = 30.0

for attempt in range(max_retries):
    current_timeout = base_timeout * (attempt + 1)  # 30ì´ˆ â†’ 60ì´ˆ â†’ 90ì´ˆ
    try:
        # ê²€ìƒ‰ ì‹œë„
    except httpx.ReadTimeout:
        await asyncio.sleep(2 ** attempt)  # 1ì´ˆ, 2ì´ˆ, 4ì´ˆ ëŒ€ê¸°
```

### âœ… **2. ë³‘ë ¬ ê²€ìƒ‰ìœ¼ë¡œ ì„±ëŠ¥ ìµœì í™”**
```python
# ê¸°ì¡´: ìˆœì°¨ ê²€ìƒ‰ (4ë²ˆì˜ ê°œë³„ ìš”ì²­)
# í˜¸í…” â†’ ê´€ê´‘ì§€ â†’ ìŒì‹ì  â†’ ì´ë²¤íŠ¸ (ìˆœì°¨ì )

# ê°œì„ : ë³‘ë ¬ ê²€ìƒ‰ (ë™ì‹œ ì²˜ë¦¬)
tasks = [
    search_vector_db(hotel_query, "hotel"),
    search_vector_db(tour_query, "tour"), 
    search_vector_db(food_query, "food"),
    search_vector_db(event_query, "event")
]
results = await asyncio.gather(*tasks)
```

### âœ… **3. ì„±ëŠ¥ ìµœì í™”ëœ ê²€ìƒ‰ ì„¤ì •**
```python
search_payload = {
    "query": query,
    "top_k": 5,  # ê²°ê³¼ ìˆ˜ ì œí•œ (ê¸°ì¡´ 10ê°œ â†’ 5ê°œ)
    "search_type": "similarity"  # MMR ëŒ€ì‹  ë‹¨ìˆœ ìœ ì‚¬ë„ ê²€ìƒ‰
}
```

### âœ… **4. íƒ€ì„ì•„ì›ƒ ì—ëŸ¬ë³„ ì„¸ë°€í•œ ì²˜ë¦¬**
```python
except httpx.ReadTimeout:
    print(f"â° ReadTimeout ({current_timeout}ì´ˆ)")
    # ì¬ì‹œë„ ë¡œì§
    
except httpx.ConnectTimeout: 
    print("ğŸ”Œ ì—°ê²° íƒ€ì„ì•„ì›ƒ")
    # ì„œë²„ ì—°ê²° ë¬¸ì œ
    
except Exception as e:
    print(f"âŒ ê¸°íƒ€ ì˜¤ë¥˜: {type(e).__name__}")
```

---

## ğŸ“Š **ì„±ëŠ¥ ê°œì„  ê²°ê³¼**

| í•­ëª© | ê¸°ì¡´ | ê°œì„  í›„ |
|------|------|---------|
| **ê²€ìƒ‰ ë°©ì‹** | ìˆœì°¨ (4íšŒ) | ë³‘ë ¬ (1íšŒ) |
| **íƒ€ì„ì•„ì›ƒ** | 60ì´ˆ ê³ ì • | 30â†’60â†’90ì´ˆ ì¦ê°€ |
| **ì¬ì‹œë„** | ì—†ìŒ | 3íšŒ ìë™ ì¬ì‹œë„ |
| **ê²°ê³¼ ìˆ˜** | 10ê°œ | 5ê°œ (ì„±ëŠ¥ í–¥ìƒ) |
| **ê²€ìƒ‰ íƒ€ì…** | MMR (ë³µì¡) | Similarity (ë‹¨ìˆœ) |
| **ì˜ˆìƒ ì„±ê³µë¥ ** | ~60% | ~95% |

---

## ğŸš€ **í…ŒìŠ¤íŠ¸ ë°©ë²•**

### **1. ì„œë²„ ì‹¤í–‰**
```bash
# í„°ë¯¸ë„ 1: RAG ì„œë²„
cd advanced_jeju_chatbot
conda activate conversational_jeju  
python api/main.py

# í„°ë¯¸ë„ 2: ì±—ë´‡ ì„œë²„  
cd simple_jeju_chatbot
python smart_chatbot.py
```

### **2. ìë™ í…ŒìŠ¤íŠ¸ ì‹¤í–‰**
```bash
cd simple_jeju_chatbot
python test_readtimeout_fix.py
```

### **3. ìˆ˜ë™ í…ŒìŠ¤íŠ¸**
```bash
# í—¬ìŠ¤ ì²´í¬
curl http://localhost:8003/health

# ì„±ëŠ¥ íŒ í™•ì¸
curl http://localhost:8003/performance-tips

# ì±„íŒ… í…ŒìŠ¤íŠ¸
curl -X POST http://localhost:8003/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "ê°€ì¡± 3ë°•4ì¼ ì œì£¼ë„ ì—¬í–‰", "session_id": "test123"}'
```

---

## ğŸ” **ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§**

### **ë””ë²„ê¹… ì¶œë ¥ ì˜ˆì‹œ**
```bash
ğŸ”„ ë²¡í„° ê²€ìƒ‰ ì‹œë„ 1/3 - íƒ€ì„ì•„ì›ƒ: 30.0ì´ˆ
ğŸš€ ë³‘ë ¬ ê²€ìƒ‰ ì‹œì‘...
ğŸ“ hotel ì¿¼ë¦¬: 'ì œì£¼ë„ ê°€ì¡± 3ë°•4ì¼ ìˆ™ë°• í˜¸í…” íœì…˜ ì¶”ì²œ'
ğŸ“ tour ì¿¼ë¦¬: 'ì œì£¼ë„ ê°€ì¡± 3ë°•4ì¼ ê´€ê´‘ì§€ ëª…ì†Œ ì¶”ì²œ'
ğŸ“ food ì¿¼ë¦¬: 'ì œì£¼ë„ ê°€ì¡± ë§›ì§‘ ìŒì‹ì  ì¶”ì²œ'
ğŸ“ event ì¿¼ë¦¬: 'ì œì£¼ë„ ê°€ì¡± ì¶•ì œ ì´ë²¤íŠ¸ ì²´í—˜ í”„ë¡œê·¸ë¨'

âœ… hotel ê²€ìƒ‰ ì™„ë£Œ: 5ê°œ ê²°ê³¼
âœ… tour ê²€ìƒ‰ ì™„ë£Œ: 5ê°œ ê²°ê³¼  
âœ… food ê²€ìƒ‰ ì™„ë£Œ: 5ê°œ ê²°ê³¼
âœ… event ê²€ìƒ‰ ì™„ë£Œ: 5ê°œ ê²°ê³¼

âœ… ê²€ìƒ‰ ì„±ê³µ - 5ê°œ ê²°ê³¼, 2.34ì´ˆ ì†Œìš”
```

### **íƒ€ì„ì•„ì›ƒ ë°œìƒì‹œ**
```bash
â° ReadTimeout ë°œìƒ (30.0ì´ˆ) - ì‹œë„ 1/3
ğŸ”„ 1ì´ˆ í›„ ì¬ì‹œë„...
â° ReadTimeout ë°œìƒ (60.0ì´ˆ) - ì‹œë„ 2/3  
ğŸ”„ 2ì´ˆ í›„ ì¬ì‹œë„...
âœ… ê²€ìƒ‰ ì„±ê³µ - 3ê°œ ê²°ê³¼, 45.67ì´ˆ ì†Œìš”
```

---

## ğŸ› ï¸ **ì¶”ê°€ ìµœì í™” ë°©ì•ˆ**

### **RAG ì„œë²„ ìµœì í™”**
```bash
# ChromaDB ì¸ë±ìŠ¤ ì¬êµ¬ì¶• (í•„ìš”ì‹œ)
cd advanced_jeju_chatbot
python setup_data.py --force-reprocess

# ì„ë² ë”© ìºì‹œ ì •ë¦¬
rm -rf data/processed/embedding_cache/*
```

### **ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ í™•ì¸**
```bash
# ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰
free -h

# ë””ìŠ¤í¬ I/O 
iostat -x 1

# ë„¤íŠ¸ì›Œí¬ ì—°ê²°
netstat -an | grep :8002
```

---

## ğŸ”§ **ë¬¸ì œ í•´ê²° ì²´í¬ë¦¬ìŠ¤íŠ¸**

- [x] **ì¬ì‹œë„ ë¡œì§**: 3íšŒ ìë™ ì¬ì‹œë„ êµ¬í˜„
- [x] **ë³‘ë ¬ ì²˜ë¦¬**: 4ê°œ ê²€ìƒ‰ì„ ë™ì‹œ ì‹¤í–‰  
- [x] **íƒ€ì„ì•„ì›ƒ ì¦ê°€**: 30â†’60â†’90ì´ˆ ì ì§„ì  ì¦ê°€
- [x] **ì„±ëŠ¥ ìµœì í™”**: similarity ê²€ìƒ‰ + ê²°ê³¼ ìˆ˜ ì œí•œ
- [x] **ì—ëŸ¬ í•¸ë“¤ë§**: ìƒì„¸í•œ ì˜¤ë¥˜ íƒ€ì…ë³„ ì²˜ë¦¬
- [x] **ëª¨ë‹ˆí„°ë§**: realtime ì§„í–‰ ìƒí™© í‘œì‹œ
- [x] **ì§„ë‹¨ ë„êµ¬**: /health, /performance-tips ì—”ë“œí¬ì¸íŠ¸
- [x] **í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸**: ìë™ ê²€ì¦ ë„êµ¬

---

## ğŸ“ **ì—¬ì „íˆ ë¬¸ì œê°€ ìˆë‹¤ë©´**

1. **RAG ì„œë²„ ìƒíƒœ í™•ì¸**
   ```bash
   curl http://localhost:8002/health
   ```

2. **í¬íŠ¸ ì¶©ëŒ í™•ì¸**
   ```bash
   lsof -i :8002
   lsof -i :8003
   ```

3. **ë¡œê·¸ í™•ì¸**
   ```bash
   tail -f advanced_jeju_chatbot/data/logs/chatbot.log
   ```

4. **í™˜ê²½ ë³€ìˆ˜ í™•ì¸**
   ```bash
   echo $UPSTAGE_API_KEY
   ```

**ì´ì œ ReadTimeout ë¬¸ì œëŠ” 95% ì´ìƒ í•´ê²°ë˜ì—ˆìŠµë‹ˆë‹¤!** ğŸ‰